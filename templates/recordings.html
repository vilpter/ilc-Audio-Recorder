<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Audio Recorder - Recordings</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen">
    <nav class="bg-blue-600 text-white p-4 shadow-lg">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-2xl font-bold">Audio Recorder</h1>
            <div class="flex items-center space-x-6">
                <div class="space-x-4">
                    <a href="/" class="hover:underline">Calendar</a>
                    <a href="/schedule" class="hover:underline">Schedule</a>
                    <a href="/recordings" class="hover:underline font-semibold">Recordings</a>
                    <a href="/settings" class="hover:underline">Settings</a>
                </div>
                <div id="current-datetime" class="text-sm font-mono bg-blue-700 px-3 py-1 rounded">
                    Loading...
                </div>
                <div class="border-l border-blue-400 pl-4 flex items-center space-x-3">
                    <span class="text-sm">{{ current_user.username }}</span>
                    <a href="/logout" class="bg-blue-700 hover:bg-blue-800 px-3 py-1 rounded text-sm">Logout</a>
                </div>
            </div>
        </div>
    </nav>

    <div class="container mx-auto p-6">
        <div class="bg-white rounded-lg shadow-md p-6">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-semibold">Recorded Files</h2>
                <div class="text-sm text-gray-600">
                    Total: <span id="file-count">{{ files|length }}</span> files
                </div>
            </div>

            {% if files %}
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead>
                        <tr class="border-b-2 border-gray-200">
                            <th class="text-left p-3 text-gray-700">Filename</th>
                            <th class="text-left p-3 text-gray-700">Size</th>
                            <th class="text-left p-3 text-gray-700">Modified</th>
                            <th class="text-left p-3 text-gray-700">Type</th>
                            <th class="text-right p-3 text-gray-700">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for file in files %}
                        <tr class="border-b border-gray-100 hover:bg-gray-50" id="file-row-{{ loop.index }}">
                            <td class="p-3">
                                <span class="font-mono text-sm">{{ file.name }}</span>
                            </td>
                            <td class="p-3 text-gray-600">
                                {{ file.size_mb }} MB
                            </td>
                            <td class="p-3 text-gray-600">
                                {{ file.modified[:10] }} {{ file.modified[11:19] }}
                            </td>
                            <td class="p-3">
                                <span class="inline-block bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded">
                                    {{ file.type }}
                                </span>
                            </td>
                            <td class="p-3 text-right space-x-2">
                                <a href="/api/recordings/{{ file.name }}" download
                                    class="inline-block bg-green-500 hover:bg-green-600 text-white text-sm px-3 py-1 rounded">
                                    Download
                                </a>
                                <button onclick="deleteFile('{{ file.name }}', {{ loop.index }})" 
                                    class="bg-red-500 hover:bg-red-600 text-white text-sm px-3 py-1 rounded">
                                    Delete
                                </button>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>

            <div class="mt-4 p-4 bg-blue-50 border border-blue-200 rounded">
                <h3 class="font-semibold text-blue-900 mb-2">Storage Info</h3>
                <p class="text-sm text-blue-800">
                    Recordings are stored in: <code class="bg-blue-100 px-2 py-1 rounded">/home/pi/recordings/</code>
                </p>
                <p class="text-sm text-blue-800 mt-1">
                    Total files size: <strong>{{ (files | map(attribute='size') | sum / 1024 / 1024) | round(2) }} MB</strong>
                </p>
            </div>

            {% else %}
            <div class="text-center py-12">
                <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                        d="M9 13h6m-3-3v6m5 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                </svg>
                <h3 class="mt-2 text-lg font-medium text-gray-900">No recordings yet</h3>
                <p class="mt-1 text-gray-500">Start a recording to see files here</p>
                <div class="mt-6">
                    <a href="/" class="inline-block bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded">
                        Go to Dashboard
                    </a>
                </div>
            </div>
            {% endif %}
        </div>
    </div>

    <script>
        // Update current date/time display
        function updateDateTime() {
            const now = new Date();
            const options = { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                hour12: false
            };
            document.getElementById('current-datetime').textContent = 
                now.toLocaleString('en-US', options);
        }
        
        // Update immediately and then every second
        updateDateTime();
        setInterval(updateDateTime, 1000);


        async function deleteFile(filename, rowIndex) {
            if (!confirm(`Delete ${filename}?`)) return;

            try {
                const response = await fetch(`/api/recordings/${filename}`, {
                    method: 'DELETE'
                });

                const result = await response.json();
                
                if (result.error) {
                    alert('Error: ' + result.error);
                } else {
                    // Remove row from table
                    document.getElementById(`file-row-${rowIndex}`).remove();
                    
                    // Update file count
                    const countElem = document.getElementById('file-count');
                    countElem.textContent = parseInt(countElem.textContent) - 1;
                    
                    // Reload if no files left
                    if (parseInt(countElem.textContent) === 0) {
                        location.reload();
                    }
                }
            } catch (error) {
                alert('Error deleting file: ' + error);
            }
        }
    </script>
</body>
</html>
